#!/bin/bash

APP_DATA=/var/lib/get-port
REQUEST=$1

function random_port {
  echo -n "$(( $(( $RANDOM % 10000 )) + 10000 ))"  
}

function get-existing-port {
  if [ -f "$APP_DATA" ]
  then
    echo -n $(awk "/^$1 / {printf \$2}" "$APP_DATA")
  fi
}


PORT=$(get-existing-port $REQUEST)

if [ -z $PORT ]
then
    PORT=$(random_port)
    echo "$REQUEST $PORT" >> $APP_DATA
fi

echo -n "$PORT"
